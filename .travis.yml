language: node_js
node_js: "10"
jobs:
  include:
    - stage: tests
      name: Windows latest
      os: windows
      install:
        - ls -la
      script:
        - npm install
        - npm run chromedriver
        - ls -la
        - ls -la chromedriver/*
    - stage:
      name: Windows CD 2.31
      os: windows
      install:
        - ls -la
      script:
        - npm install
        - npm run chromedriver --chromedriver_version='2.31'
        - ls -la
        - ls -la chromedriver/*
    - stage:
      name: Unit tests
      os: linux
      dist: trusty
      script:
        - npm test
      after_success:
        - npm run coverage
    - stage:
      name: Functional tests
      os: linux
      dist: trusty
      env:
        - _FORCE_LOGS=1
      addons:
        chrome: stable
      before_script:
        - "export DISPLAY=:99.0"
        - "sh -e /etc/init.d/xvfb start"
        - sleep 3
        - npm run chromedriver
      script:
        - npm run e2e-test
